<!-- lib/movie_search_web/live/movie_live.html.heex -->
<div class="app-container">
  <h1 class="app-title">ğŸ¬ Recherche de Films</h1>
  <!-- Panel de recherche et filtres -->
  <div class="search-panel">
    <div class="search-grid">
      <!-- Recherche textuelle -->
      <div class="form-group">
        <label class="form-label">ğŸ” Rechercher</label>
        <form phx-change="search">
          <input
            type="text"
            name="search[query]"
            value={@search_query}
            placeholder="Titre, rÃ©alisateur, genre..."
            class="form-input"
          />
        </form>
      </div>
      <!-- Filtre par genre -->
      <div class="form-group">
        <label class="form-label">ğŸ­ Genre</label>
        <select
          phx-change="filter_genre"
          name="genre"
          class="form-select"
        >
          <option value="">Tous les genres</option>
          
          <%= for genre <- @genres do %>
            <option value={genre} selected={@selected_genre == genre}>{genre}</option>
          <% end %>
        </select>
      </div>
      <!-- Filtre par note -->
      <div class="form-group">
        <label class="form-label">â­ Note minimale</label>
        <select
          phx-change="filter_rating"
          name="rating"
          class="form-select"
        >
          <option value="0">Toutes</option>
          
          <option value="8.0" selected={@min_rating == 8.0}>8.0+</option>
          
          <option value="8.5" selected={@min_rating == 8.5}>8.5+</option>
          
          <option value="9.0" selected={@min_rating == 9.0}>9.0+</option>
        </select>
      </div>
      <!-- Tri -->
      <div class="form-group">
        <label class="form-label">ğŸ“Š Trier par</label>
        <select
          phx-change="sort"
          name="sort_by"
          class="form-select"
        >
          <option value="title" selected={@sort_by == "title"}>Titre</option>
          
          <option value="year" selected={@sort_by == "year"}>AnnÃ©e</option>
          
          <option value="rating" selected={@sort_by == "rating"}>Note</option>
          
          <option value="duration" selected={@sort_by == "duration"}>DurÃ©e</option>
        </select>
      </div>
    </div>
    <!-- Actions -->
    <!-- Dans search-actions, ajoute ce bouton -->
    <div class="search-actions">
      <p class="results-count"><strong>{length(@movies)}</strong> film(s) trouvÃ©(s)</p>
      
      <div class="action-buttons">
        <button
          phx-click="check_missing_images"
          class="imdb-button"
          title="VÃ©rifie et retÃ©lÃ©charge les images manquantes"
        >
          ğŸ”§ RÃ©parer Images
        </button>
        <button
          phx-click="reset_filters"
          class="reset-button"
        >
          ğŸ”„ RÃ©initialiser
        </button>
      </div>
    </div>
  </div>
  <!-- Bouton pour afficher le formulaire d'ajout -->
  <div class="add-movie-section">
    <%= if not @show_form do %>
      <button
        phx-click="show_form"
        class="add-movie-button"
      >
        â• Ajouter un Film
      </button>
    <% end %>
    <!-- Formulaire d'ajout -->
    <%= if @show_form do %>
      <div class="add-movie-form">
        <div class="form-header">
          <h3>â• Ajouter un Nouveau Film</h3>
           <button phx-click="hide_add_form" class="close-button">âœ–</button>
        </div>
        <!-- Erreurs de validation -->
        <%= if not Enum.empty?(@form_errors) do %>
          <div class="form-errors">
            <%= for error <- @form_errors do %>
              <p class="error-message">âš ï¸ {error}</p>
            <% end %>
          </div>
        <% end %>
        
        <form phx-submit="add_movie">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">ğŸ¬ Titre</label>
              <input
                type="text"
                name="movie[title]"
                class="form-input"
                placeholder="Ex: Blade Runner"
                required
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">ğŸ“… AnnÃ©e</label>
              <input
                type="number"
                name="movie[year]"
                class="form-input"
                placeholder="Ex: 1982"
                min="1900"
                max="2030"
                required
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">ğŸ­ Genre(s)</label>
              <input
                type="text"
                name="movie[genre]"
                class="form-input"
                placeholder="Ex: Sci-Fi, Thriller"
                required
              /> <small class="form-hint">SÃ©parez par des virgules</small>
            </div>
            
            <div class="form-group">
              <label class="form-label">ğŸ¬ RÃ©alisateur</label>
              <input
                type="text"
                name="movie[director]"
                class="form-input"
                placeholder="Ex: Ridley Scott"
                required
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">â­ Note</label>
              <input
                type="number"
                name="movie[rating]"
                class="form-input"
                placeholder="Ex: 8.1"
                min="0"
                max="10"
                step="0.1"
                required
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">â±ï¸ DurÃ©e (min)</label>
              <input
                type="number"
                name="movie[duration]"
                class="form-input"
                placeholder="Ex: 117"
                min="1"
                required
              />
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">ğŸ“ Description</label> <textarea
              name="movie[description]"
              class="form-textarea"
              placeholder="RÃ©sumÃ© du film..."
              rows="3"
            ></textarea>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="submit-button">ğŸ’¾ Ajouter le Film</button>
            <button type="button" phx-click="hide_add_form" class="cancel-button">
              âŒ Annuler
            </button>
          </div>
        </form>
      </div>
    <% end %>
  </div>
  <!-- Grille des films -->
  <div class="movies-grid">
    <%= for movie <- @movies do %>
      <div class="movie-card">
        <!-- Poster du film -->
        <div class="movie-poster">
          <img
            src={movie.poster}
            alt={movie.title}
            loading="lazy"
          />
        </div>
        <!-- Informations du film -->
        <div class="movie-info">
          <h3 class="movie-title">{movie.title}</h3>
          
          <div class="movie-meta">
            <span class="movie-year">{movie.year}</span>
            <div class="movie-rating">
              <span class="star">â­</span> <span class="score">{movie.rating}</span>
            </div>
          </div>
          
          <p class="movie-director">ğŸ¬ RÃ©alisÃ© par {movie.director}</p>
          
          <p class="movie-genres">{format_genres(movie.genre)}</p>
          
          <p class="movie-duration">â±ï¸ {format_duration(movie.duration)}</p>
          
          <p class="movie-description">{movie.description}</p>
        </div>
        <div class="action-buttons">
          <button phx-click="edit_movie" phx-value-id={movie.id} class="edit-button">âœï¸ Ã‰diter</button>
          <button phx-click="delete_movie" phx-value-id={movie.id} data-confirm="Voulez-vous vraiment supprimer ?" class="delete-button">ğŸ—‘ï¸ Supprimer</button>
        </div>
      </div>
    <% end %>
  </div>
  <!-- Message si aucun film trouvÃ© -->
  <%= if Enum.empty?(@movies) do %>
    <div class="empty-state">
      <div class="icon">ğŸ”</div>
      
      <h3>Aucun film trouvÃ©</h3>
      
      <p>Essayez de modifier vos critÃ¨res de recherche</p>
    </div>
  <% end %>
</div>
